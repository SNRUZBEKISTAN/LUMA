# Google OAuth Integration –¥–ª—è LUMA

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google OAuth –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ LUMA. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º —á–µ—Ä–µ–∑ —Å–≤–æ–π Google –∞–∫–∫–∞—É–Ω—Ç –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

- **Google Identity Services (GSI)** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç Google
- **JWT Token Decoding** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
- **Fallback —Ä–µ–∂–∏–º** - –¥–µ–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ OAuth –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - –∫—Ä–∞—Å–∏–≤–∞—è –∫–Ω–æ–ø–∫–∞ Google —Å –∏–∫–æ–Ω–∫–æ–π
- **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **Error handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Token management** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤

### üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –∫–Ω–æ–ø–∫—É Google** –≤ —Ñ–æ—Ä–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è Client ID** - –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
3. **–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Google Auth popup** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç
4. **–ü–æ–ª—É—á–∞–µ–º JWT token** - Google –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
5. **–î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ** - –∏–∑–≤–ª–µ–∫–∞–µ–º email, –∏–º—è, –∫–∞—Ä—Ç–∏–Ω–∫—É
6. **–°–æ–∑–¥–∞–µ–º LUMA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
7. **–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω** - –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
8. **–ó–∞–≤–µ—Ä—à–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. Google Cloud Console

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ **Google Identity Services API**
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **APIs & Services > Credentials**
5. –ù–∞–∂–º–∏—Ç–µ **Create Credentials > OAuth 2.0 Client ID**
6. –í—ã–±–µ—Ä–∏—Ç–µ **Web application**
7. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω—ã –≤ **Authorized JavaScript origins**:
   - `http://localhost:3000` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
   - `https://yourdomain.com` (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### 2. Environment Variables

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
REACT_APP_GOOGLE_CLIENT_ID=your_google_client_id_here.apps.googleusercontent.com
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm restart
# –∏–ª–∏
yarn start
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- **Client ID –Ω–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ frontend –∫–æ–¥–µ
- **JWT —Ç–æ–∫–µ–Ω—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è** - –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
- **–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- **HTTPS –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –¥–æ–º–µ–Ω–æ–≤
- **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã** - –≤ localStorage —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### üîí –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:

- –¢–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (1 —á–∞—Å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ JWT
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ GSI)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/components/
  ‚îú‚îÄ‚îÄ AuthLite.tsx              # –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  ‚îú‚îÄ‚îÄ GoogleAuthProvider.tsx    # Provider –¥–ª—è Google SDK
  ‚îî‚îÄ‚îÄ GoogleSetupGuide.tsx     # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

/utils/
  ‚îî‚îÄ‚îÄ googleAuth.ts            # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google OAuth

/.env.example                  # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
/docs/GoogleOAuth.md          # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## API –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### GoogleAuthProvider

```tsx
<GoogleAuthProvider onSuccess={handleSuccess} onError={handleError}>
  {children}
</GoogleAuthProvider>
```

**Props:**
- `onSuccess: (credentialResponse) => void` - —É—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `onError: () => void` - –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –£—Ç–∏–ª–∏—Ç—ã googleAuth.ts

```tsx
import {
  decodeGoogleJWT,          // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
  createLumaUserFromGoogle, // –°–æ–∑–¥–∞–Ω–∏–µ LUMA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  saveGoogleToken,          // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  getGoogleToken,           // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  clearGoogleToken,         // –û—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞
  isGoogleAuthenticated     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
} from '../utils/googleAuth';
```

## –î–µ–º–æ —Ä–µ–∂–∏–º

–ï—Å–ª–∏ Google OAuth –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

- **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ** –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É Google
- **Fallback –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –¥–∞–Ω–Ω—ã–º–∏ Google
- **–†–∞–±–æ—Ç–∞–µ—Ç –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

**1. "Google SDK –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

**2. "Client ID –Ω–µ –Ω–∞–π–¥–µ–Ω"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `REACT_APP_`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ development server

**3. "OAuth popup –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ popup)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ Google Console
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –¥–æ–º–µ–Ω–∞

**4. "Token invalid –∏–ª–∏ expired"**
- –¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 1 —á–∞—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ

## –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

- **Refresh —Ç–æ–∫–µ–Ω—ã** - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **Backend –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ  
- **Multi-domain support** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- **Analytics integration** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–π
- **Custom scopes** - –∑–∞–ø—Ä–æ—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Google Identity Services Docs:** https://developers.google.com/identity/gsi/web
- **JWT.io:** https://jwt.io/ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤)
- **Google Cloud Console:** https://console.cloud.google.com/